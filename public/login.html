<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acceso administrador - Isabel, Detalles Eternos</title>

    <!-- Tailwind permitido porque ya lo habilitaste en CSP -->
    <link rel="stylesheet" href="/css/output.css?v=2">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" defer></script>
</head>

<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="bg-white shadow-lg rounded-xl p-6 sm:p-8 w-full max-w-md">
        <h2 class="text-2xl font-bold text-center mb-1 text-green-700">
            Acceso administrador
        </h2>
        <p class="text-center text-gray-500 text-sm mb-6">Para personal de la tienda</p>

        <form id="loginForm" class="space-y-4">

            <div>
                <label class="block mb-1 font-medium">Correo electr칩nico</label>
                <input id="email" type="email"
                    class="w-full border p-2 rounded focus:outline-none focus:ring focus:ring-green-300" required>
            </div>

            <div>
                <label class="block mb-1 font-medium">Contrase침a</label>
                <input id="password" type="password"
                    class="w-full border p-2 rounded focus:outline-none focus:ring focus:ring-green-300" required>
            </div>

            <div class="flex flex-col gap-3 w-full">
                <button type="submit"
                    class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition">
                    Ingresar
                </button>
                <a href="/index.html" role="button"
                    class="w-full bg-gray-300 hover:bg-gray-400 text-gray-800 py-3 rounded-lg font-semibold transition text-center block">
                    Cancelar
                </a>
            </div>
        </form>

        <p id="msg" class="text-center mt-4 text-red-600 font-semibold"></p>
    </div>

    <script>
        document.getElementById("loginForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const email = document.getElementById("email").value.trim();
            const password = document.getElementById("password").value.trim();

            try {
                const res = await fetch("/api/auth/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password })
                });

                const data = await res.json();
                //console.log("RESPUESTA LOGIN:", data);


                if (!res.ok) {
                    alert(data.mensaje || "Credenciales incorrectas");
                    return;
                }

                // 游댏 Guardar SOLO el token
                console.log("RESPUESTA LOGIN:", data);
                localStorage.setItem("token", data.token);
                localStorage.setItem("rol", data.usuario.rol);
                localStorage.setItem("nombre", data.usuario.nombre);
                localStorage.setItem("usuario_id", data.usuario.id);

                // Mensaje que se oculta solo y luego redirige (sin bot칩n Aceptar)
                Swal.fire({
                    icon: "success",
                    title: "Inicio de sesi칩n exitoso",
                    timer: 1500,
                    timerProgressBar: true,
                    showConfirmButton: false
                }).then(() => {
                    window.location.href = "/pedidos_admin.html";
                });

            } catch (error) {
                alert("No se pudo conectar con el servidor");
                console.error("ERROR LOGIN:", error);
            }
        });
    </script>

</body>

</html>